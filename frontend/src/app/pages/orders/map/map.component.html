<div class="header bg-gradient-blue pb-8 pt-5 pt-md-8">
  <div class="container-fluid">
    <div class="header-body">
      <div class="row">
        <div class="col">
          <h1 class="text-white mb-0">üó∫Ô∏è Mapa de Pedidos en Tiempo Real</h1>
          <p class="text-white-50 mb-0">Ubicaci√≥n actual de las motocicletas con pedidos asignados</p>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid mt--7">
  <div class="row">
    <div class="col">
      <div class="card shadow">
        <div class="card-header border-0">
          <div class="row align-items-center">
            <div class="col">
              <h3 class="mb-0">Ubicaciones en Tiempo Real</h3>
            </div>
            <div class="col text-right">
              <span class="badge badge-success badge-lg">
                <i class="fas fa-circle"></i> {{ motorcycleLocations.length }} Motos Activas
              </span>
            </div>
          </div>
        </div>

        <!-- Leyenda -->
        <div class="card-body py-2 border-bottom">
          <div class="row">
            <div class="col-12">
              <small class="text-muted d-flex align-items-center gap-3">
                <span><i class="fas fa-circle text-warning"></i> En preparaci√≥n</span>
                <span><i class="fas fa-circle text-primary"></i> En camino</span>
                <span><i class="fas fa-circle text-info"></i> Cerca del destino</span>
              </small>
            </div>
          </div>
        </div>

        <!-- Mapa -->
        <div class="map-container">
          <ng-container *ngIf="mapsLoaded; else mapPlaceholder">
            <google-map
              [center]="center"
              [zoom]="zoom"
              [options]="options"
              width="100%"
              height="600px">
              
              <!-- Marcadores de motocicletas -->
              <map-marker
                *ngFor="let location of motorcycleLocations"
                [position]="{ lat: location.lat, lng: location.lng }"
                [title]="location.licensePlate"
                [options]="{ icon: getMarkerIcon(location.status) }"
                [animation]="markerAnimation"
                (mapClick)="openInfoWindow(location)">
              </map-marker>

              <!-- Ventanas de informaci√≥n -->
              <map-info-window>
                <div class="info-window-content">
                  <h6 class="mb-2">{{ motorcycleLocations[0]?.licensePlate }}</h6>
                  <p class="mb-1 small"><strong>Estado:</strong> {{ motorcycleLocations[0]?.status }}</p>
                  <p class="mb-1 small"><strong>Cliente:</strong> {{ motorcycleLocations[0]?.customerName }}</p>
                  <p class="mb-0 small"><strong>Direcci√≥n:</strong> {{ motorcycleLocations[0]?.address }}</p>
                </div>
              </map-info-window>
            </google-map>
          </ng-container>
          <ng-template #mapPlaceholder>
            <div class="alert alert-warning rounded-0 mb-0 text-center px-4 py-5">
              <p class="mb-1"><strong>Mapa no disponible</strong></p>
              <p class="mb-0 small text-muted">
                {{ mapLoadError || 'Estamos cargando Google Maps. Si el problema persiste, verifica la clave y la facturaci√≥n.' }}
              </p>
            </div>
          </ng-template>
        </div>

        <!-- Lista de pedidos activos -->
        <div class="card-body border-top">
          <h4 class="mb-3">Pedidos Activos</h4>
          <div class="row">
            <div class="col-md-6 col-lg-4 mb-3" *ngFor="let location of motorcycleLocations">
              <div class="card border-left-primary shadow-sm h-100">
                <div class="card-body p-3">
                  <div class="d-flex align-items-center mb-2">
                    <i class="fas fa-motorcycle text-primary mr-2"></i>
                    <strong>{{ location.licensePlate }}</strong>
                  </div>
                  <p class="mb-1 small">
                    <span class="badge" 
                          [ngClass]="{
                            'badge-warning': location.status === 'En preparaci√≥n',
                            'badge-primary': location.status === 'En camino',
                            'badge-info': location.status === 'Cerca del destino'
                          }">
                      {{ location.status }}
                    </span>
                  </p>
                  <p class="mb-1 small text-muted">
                    <i class="fas fa-user"></i> {{ location.customerName }}
                  </p>
                  <p class="mb-0 small text-muted">
                    <i class="fas fa-map-marker-alt"></i> {{ location.address }}
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="motorcycleLocations.length === 0" class="text-center py-5">
            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
            <p class="text-muted">No hay pedidos activos con motos asignadas</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
